## Android编译时注解框架6-APT的优缺点与应用

### 概述

如果你已经读完了前面的5章博客，相信你已经对APT整体已经比较熟悉了，所以，APT真的很简单对嘛？

但就像我前面提到过的，**APT是一套非常强大的机制，它唯一的限制在于你天马行空的设计！** 

APT有着非常简单的技术实现，但其应用场景却着实有点尴尬。我一直期望可以探索出ButterKnife和EventBus以外的应用场景，却始终未能如愿。姑且把我目前总结的成果列举，共勉~

（**本系列所讲APT均泛指编译时注解+代码生成**，虽然运行时注解也属APT）

### APT优点

- 对代码进行标记，在编译时收集信息，并做处理。

- 生成一套独立代码，辅助代码运行

- 生成代码位置的可控性，与原有代码的关联性更为紧密方便

- 更为可靠的自动代码生成

- 自动生成的代码可以最大程度的简单粗暴，不必考虑编写效率的情况下提高运行效率


### APT缺点

- APT往往容易被误解可以实现代码插入，然而事实是并不可以

- APT可以自动生成代码，但在运行时却需要主动调用

- 与GreenDao不同，GreenDao代码生成于app目录下，编写时可以调用并修改。APT代码生成于Build目录，只能在运行时通过接口等方式进行操作。这意味着生成的代码必须要有一套固定的模板


### APT容易被你忽视的点

一个非常容易被你误解的点：只有被注解标记了的类或方法等，才可以被处理或收集信息。或者这样说，想要收集一些信息，只能先用注解修饰它。

产生这样误解容易引起一个问题：你可能会觉得一个需要大量注解的框架体验不好而决定放弃。

事实是怎么样呢？想一下同源的运行时注解+反射。反射可以通过一个类名便获取一个类的所有信息（方法、属性、方法参数等等等）。编译时注解也是可以的。当你修饰一个类时，可以通过类的Element获得类的属性和方法的Element,通过属性的Element可以获得属性所属类的信息，通过方法的Element可以获得所属类和其参数的信息。

说白了，编译时注解你也完全可以当反射来理解。

APT的优缺点都非常明显，优点足够了，缺点也不致命，只是让你在设计你的框架，选择技术方案时注意就好了。那么基于上面列出的几点，几个通用的应用场景就可以被设想了~**一定要放大你的脑洞！！！**

### 应用场景-信息收集与统计


注解的主要作用就是用于标记，所以最基础的应用就是信息收集与统计。可能你还是有点懵懵懂懂，没关系，举例子嘛~

#### 编译时代码检查或统计

统计可能会一点奇怪：看看我这次写了多少个方法呀，多少个类呀。回头可以给BOSS说一下，以后KPI用方法数来计算？抱歉我的脑洞也就这样了，你再扩招一下~

	//示例代码  类统计

代码检查就比较靠谱一点了：类名是不是首字母大写的驼峰式啊？方法名有没有问题呀？常量是不是全大写啊？

这里你可能比较好奇，我怎么检查啊，难道要给每个类都加一个注解嘛？不不不，你看刚刚我们才讲了：【APT容易被你忽视的点】，只需要一个就够了~

	//示例代码  代码检查
	
#### 运行时数据收集与统计

这里我只能提供一个方向，脑洞还是不够啊。

灵感来源于一个你不陌生的类：BuildConfig.

在BuildConfig中存放着一些静态属性，而这些静态属性值是Grandle编译时赋予的。可能这里你最常用的就是 BuildConfig.DEBUG了。

同理，APT也可以实现这样的功能。


### 应用场景-事件代理

此类应用场景的标志框架是ButterKnife。通过生成的代码代理实现View绑定。

	//示例代码
	

	








